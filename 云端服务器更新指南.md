# ğŸš€ äº‘ç«¯æœåŠ¡å™¨æ›´æ–°æŒ‡å—

## æ›´æ–°ä»£ç åˆ°å·²éƒ¨ç½²çš„æœåŠ¡å™¨

æ‚¨çš„æœåŠ¡å™¨å·²ç»éƒ¨ç½²è¿‡äº†ï¼Œç°åœ¨éœ€è¦æ›´æ–°ä»£ç ä»¥åº”ç”¨æ–°çš„ Logo å’Œæ”¹è¿›ã€‚

---

## ğŸ”„ å¿«é€Ÿæ›´æ–°æµç¨‹ï¼ˆ5åˆ†é’Ÿï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ Git æ‹‰å–ï¼ˆæ¨èï¼‰

å¦‚æœæœåŠ¡å™¨ä¸Šçš„ä»£ç æ˜¯é€šè¿‡ Git å…‹éš†çš„ï¼š

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/chiavow

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 4. é‡æ–°æ„å»ºå‰ç«¯
cd client
npm install  # å¦‚æœæœ‰æ–°ä¾èµ–
npm run build

# 5. é‡å¯åç«¯ï¼ˆå¦‚æœæœ‰åç«¯æ”¹åŠ¨ï¼‰
cd ../server
npm install  # å¦‚æœæœ‰æ–°ä¾èµ–
npm run build
pm2 restart chiavow-api

# 6. é‡å¯ Nginxï¼ˆå¦‚æœæœ‰é…ç½®æ”¹åŠ¨ï¼‰
sudo systemctl reload nginx

# å®Œæˆï¼
```

### æ–¹æ³•2ï¼šé‡æ–°ä¸Šä¼ ä»£ç 

å¦‚æœæ²¡æœ‰ä½¿ç”¨ Gitï¼š

```bash
# åœ¨æœ¬åœ°æ‰“åŒ…
cd /Users/xinguanliyuan/Desktop/indoor_chart
tar -czf chiavow-update.tar.gz chiavow/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp chiavow-update.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/root/

# SSH ç™»å½•æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# å¤‡ä»½æ—§ä»£ç ï¼ˆé‡è¦ï¼ï¼‰
cd /root
mv chiavow chiavow-backup-$(date +%Y%m%d)

# è§£å‹æ–°ä»£ç 
tar -xzf chiavow-update.tar.gz

# é‡æ–°æ„å»ºå’Œå¯åŠ¨
cd chiavow/client
npm install
npm run build

cd ../server
npm install
npm run build
pm2 restart chiavow-api

sudo systemctl reload nginx
```

---

## ğŸ“‹ è¯¦ç»†æ›´æ–°æ­¥éª¤

### ç¬¬1æ­¥ï¼šæœ¬åœ°æ¨é€ä»£ç 

```bash
# åœ¨æœ¬åœ°
cd /Users/xinguanliyuan/Desktop/indoor_chart/chiavow

# ç¡®è®¤å·²æäº¤
git status

# æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆå¦‚æœä½¿ç”¨ GitHub/GitLabï¼‰
git push origin main
```

### ç¬¬2æ­¥ï¼šæœåŠ¡å™¨æ‹‰å–ä»£ç 

```bash
# SSH ç™»å½•
ssh root@ä½ çš„æœåŠ¡å™¨IP

# è¿›å…¥é¡¹ç›®
cd /root/chiavow

# æŸ¥çœ‹å½“å‰çŠ¶æ€
git status
git log --oneline -5

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æŸ¥çœ‹æ›´æ–°çš„æ–‡ä»¶
git log --oneline -1
git show --name-only
```

### ç¬¬3æ­¥ï¼šæ›´æ–°å‰ç«¯

```bash
cd /root/chiavow/client

# æ£€æŸ¥æ˜¯å¦æœ‰æ–°ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# éªŒè¯æ„å»º
ls -lh dist/

# æ£€æŸ¥ Logo æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh public/*.svg
```

### ç¬¬4æ­¥ï¼šæ›´æ–°åç«¯ï¼ˆå¦‚æœæœ‰æ”¹åŠ¨ï¼‰

```bash
cd /root/chiavow/server

# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# æŸ¥çœ‹ PM2 çŠ¶æ€
pm2 status

# é‡å¯åº”ç”¨
pm2 restart chiavow-api

# æŸ¥çœ‹æ—¥å¿—
pm2 logs chiavow-api --lines 50
```

###ç¬¬5æ­¥ï¼šé‡å¯ Nginx

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx

# æˆ–å®Œå…¨é‡å¯
sudo systemctl restart nginx

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status nginx
```

---

## âœ… éªŒè¯æ›´æ–°

### 1. æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€

```bash
# åç«¯çŠ¶æ€
pm2 status
pm2 logs chiavow-api --lines 20

# Nginx çŠ¶æ€
sudo systemctl status nginx

# ç«¯å£ç›‘å¬
netstat -tlnp | grep -E '(3001|80|443)'
```

### 2. æµ‹è¯•è®¿é—®

```bash
# æµ‹è¯•åç«¯
curl http://localhost:3001/api/health

# æµ‹è¯•å‰ç«¯
curl http://localhost

# æµ‹è¯• Logo æ–‡ä»¶
curl -I http://localhost/logo.svg
curl -I http://localhost/logo-small.svg
curl -I http://localhost/favicon.svg
```

### 3. æµè§ˆå™¨éªŒè¯

è®¿é—®ä»¥ä¸‹ URLï¼š

1. **ä¸»é¡µ**: `http://ä½ çš„æœåŠ¡å™¨IP` æˆ– `https://ä½ çš„åŸŸå.com`
2. **æ£€æŸ¥ Logo**:
   - ç™»å½•é¡µåº”æ˜¾ç¤ºå¤§ Logoï¼ˆå¸¦æµ®åŠ¨åŠ¨ç”»ï¼‰
   - ä¸»ç•Œé¢é¡¶éƒ¨åº”æ˜¾ç¤ºå° Logo + "Chiavow" æ–‡å­—
   - æµè§ˆå™¨æ ‡ç­¾é¡µåº”æ˜¾ç¤ºæ–° favicon

3. **æ£€æŸ¥æ–‡ä»¶**:
   - `http://ä½ çš„åŸŸå.com/logo.svg`
   - `http://ä½ çš„åŸŸå.com/logo-small.svg`
   - `http://ä½ çš„åŸŸå.com/favicon.svg`

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šLogo ä¸æ˜¾ç¤º

**åŸå› **: æ–‡ä»¶è·¯å¾„æˆ–æ„å»ºé—®é¢˜

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh /root/chiavow/client/dist/logo*.svg
ls -lh /root/chiavow/client/dist/favicon.svg

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
cat /etc/nginx/sites-enabled/chiavow | grep "root"

# æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
cp /root/chiavow/client/public/*.svg /root/chiavow/client/dist/
```

### é—®é¢˜2ï¼šå‰ç«¯æ²¡æœ‰æ›´æ–°

**åŸå› **: æµè§ˆå™¨ç¼“å­˜

```bash
# æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
cd /root/chiavow/client
rm -rf dist/
npm run build

# é‡å¯ Nginx
sudo systemctl restart nginx
```

**åœ¨æµè§ˆå™¨ä¸­**:
- æŒ‰ `Ctrl + Shift + R` (Windows/Linux) æˆ– `Cmd + Shift + R` (Mac) å¼ºåˆ¶åˆ·æ–°
- æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### é—®é¢˜3ï¼šåç«¯é”™è¯¯

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs chiavow-api --lines 100

# é‡å¯åç«¯
pm2 restart chiavow-api

# æŸ¥çœ‹è¿›ç¨‹
pm2 list
ps aux | grep node
```

### é—®é¢˜4ï¼šGit æ‹‰å–å†²çª

```bash
# æŸ¥çœ‹å†²çªæ–‡ä»¶
git status

# å¦‚æœæœ¬åœ°æœ‰ä¿®æ”¹ï¼Œä¿å­˜åˆ° stash
git stash

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœéœ€è¦æ¢å¤æœ¬åœ°ä¿®æ”¹
git stash pop

# æˆ–è€…å¼ºåˆ¶è¦†ç›–æœ¬åœ°æ”¹åŠ¨
git fetch origin
git reset --hard origin/main
```

---

## ğŸ“Š æ›´æ–°æ£€æŸ¥æ¸…å•

### æ›´æ–°å‰
- [ ] æœ¬åœ°ä»£ç å·²æäº¤åˆ° Git
- [ ] å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] å¤‡ä»½æœåŠ¡å™¨å½“å‰ä»£ç 
- [ ] è®°å½•å½“å‰ PM2 è¿è¡ŒçŠ¶æ€

### æ›´æ–°ä¸­
- [ ] SSH æˆåŠŸè¿æ¥æœåŠ¡å™¨
- [ ] Git pull æˆåŠŸæˆ–æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] å‰ç«¯æ„å»ºæˆåŠŸï¼ˆ`npm run build`ï¼‰
- [ ] åç«¯æ„å»ºæˆåŠŸï¼ˆ`npm run build`ï¼‰
- [ ] PM2 é‡å¯æˆåŠŸ
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡

### æ›´æ–°å
- [ ] åç«¯ API æ­£å¸¸å“åº”
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
- [ ] Logo æ–‡ä»¶å¯è®¿é—®
- [ ] ç™»å½•é¡µ Logo æ˜¾ç¤ºæ­£å¸¸
- [ ] ä¸»ç•Œé¢é¡¶éƒ¨ Logo æ˜¾ç¤ºæ­£å¸¸
- [ ] Favicon æ˜¾ç¤ºæ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å’Œ PC ç«¯éƒ½æ­£å¸¸

---

## ğŸ” å®‰å…¨æ›´æ–°ï¼ˆæ¨èï¼‰

### ä½¿ç”¨ Git éƒ¨ç½²å¯†é’¥

æ›´å®‰å…¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ SSH å¯†é’¥ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆå¯†é’¥
ssh-keygen -t ed25519 -C "deploy@chiavow"

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub

# å°†å…¬é’¥æ·»åŠ åˆ° GitHub/GitLab çš„ Deploy Keys
```

### è®¾ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

åˆ›å»ºæ›´æ–°è„šæœ¬ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
sudo nano /root/update-chiavow.sh
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/bin/bash

set -e

echo "ğŸš€ Starting Chiavow update..."

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/chiavow

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
BACKUP_DIR="/root/backups/chiavow-$(date +%Y%m%d-%H%M%S)"
mkdir -p /root/backups
echo "ğŸ“¦ Creating backup to $BACKUP_DIR"
cp -r /root/chiavow $BACKUP_DIR

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ Pulling latest code..."
git pull origin main

# æ›´æ–°å‰ç«¯
echo "ğŸ”¨ Building frontend..."
cd client
npm install
npm run build

# æ›´æ–°åç«¯
echo "ğŸ”¨ Building backend..."
cd ../server
npm install
npm run build

# é‡å¯æœåŠ¡
echo "â™»ï¸  Restarting services..."
pm2 restart chiavow-api
sudo systemctl reload nginx

# æ£€æŸ¥çŠ¶æ€
echo "âœ… Checking services..."
pm2 status
sudo systemctl status nginx --no-pager

echo "ğŸ‰ Update completed successfully!"
```

ä½¿è„šæœ¬å¯æ‰§è¡Œï¼š

```bash
chmod +x /root/update-chiavow.sh
```

ä½¿ç”¨è„šæœ¬æ›´æ–°ï¼š

```bash
/root/update-chiavow.sh
```

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°å†…å®¹

æ­¤æ¬¡æ›´æ–°åŒ…å«ï¼š

1. **æ–°å¢ Logo æ–‡ä»¶**:
   - `/client/public/logo.svg` - ä¸» Logo (120x120)
   - `/client/public/logo-small.svg` - å° Logo (40x40)
   - `/client/public/favicon.svg` - Favicon (32x32)

2. **å‰ç«¯æ›´æ–°**:
   - ç™»å½•é¡µæ·»åŠ  Logo å’Œæµ®åŠ¨åŠ¨ç”»
   - ä¸»ç•Œé¢æ·»åŠ é¡¶éƒ¨å¯¼èˆªæ å’Œ Logo
   - æ›´æ–° HTML meta æ ‡ç­¾

3. **æ–‡æ¡£**:
   - Logo è®¾è®¡è¯´æ˜æ–‡æ¡£
   - åŸŸåå’Œ HTTPS é…ç½®æŒ‡å—
   - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

---

## â±ï¸ é¢„è®¡æ—¶é—´

| æ­¥éª¤ | æ—¶é—´ |
|-----|-----|
| SSH ç™»å½•æœåŠ¡å™¨ | 1åˆ†é’Ÿ |
| Git pull / ä¸Šä¼ ä»£ç  | 1-2åˆ†é’Ÿ |
| æ„å»ºå‰ç«¯ | 1-2åˆ†é’Ÿ |
| æ„å»ºåç«¯ | 1åˆ†é’Ÿ |
| é‡å¯æœåŠ¡ | 1åˆ†é’Ÿ |
| éªŒè¯æµ‹è¯• | 2åˆ†é’Ÿ |
| **æ€»è®¡** | **çº¦ 5-10åˆ†é’Ÿ** |

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### æŸ¥çœ‹æ—¥å¿—

```bash
# PM2 æ—¥å¿—
pm2 logs chiavow-api

# Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# Nginx è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u nginx -n 50
```

### å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬

å¦‚æœæ›´æ–°å‡ºç°é—®é¢˜ï¼š

```bash
# ä½¿ç”¨ Git å›æ»š
cd /root/chiavow
git log --oneline -5
git reset --hard <ä¸Šä¸€ä¸ªcommit-id>

# æˆ–æ¢å¤å¤‡ä»½
cd /root
rm -rf chiavow
mv chiavow-backup-20251126 chiavow

# é‡æ–°æ„å»ºå’Œå¯åŠ¨
cd chiavow/client && npm run build
cd ../server && npm run build
pm2 restart chiavow-api
sudo systemctl reload nginx
```

---

**ç¥æ›´æ–°é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶æŸ¥çœ‹æ—¥å¿—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
