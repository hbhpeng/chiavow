# ðŸš€ åŸŸåå’ŒHTTPSå¿«é€Ÿé…ç½®ï¼ˆ30åˆ†é’Ÿï¼‰

## ðŸ“ å‡†å¤‡æ¸…å•

- [ ] å·²è´­ä¹°åŸŸåï¼ˆå¦‚ chiavow.comï¼‰
- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆæœ‰å…¬ç½‘IPï¼‰
- [ ] å¯ä»¥SSHç™»å½•æœåŠ¡å™¨
- [ ] æœåŠ¡å™¨å·²å®‰è£… Node.js, PM2, Nginx

## âš¡ 5æ­¥å¿«é€Ÿé…ç½®

### ç¬¬1æ­¥ï¼šé…ç½®DNSè§£æžï¼ˆ5åˆ†é’Ÿï¼‰

```
ç™»å½•åŸŸåç®¡ç†åŽå° â†’ æ·»åŠ è§£æžè®°å½•ï¼š

è®°å½•1ï¼š
ç±»åž‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨IPï¼ˆå¦‚ 47.100.123.456ï¼‰

è®°å½•2ï¼š
ç±»åž‹ï¼šA
ä¸»æœºè®°å½•ï¼šwww
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨IP
```

**éªŒè¯ï¼š**
```bash
ping chiavow.com  # åº”è¯¥è¿”å›žä½ çš„æœåŠ¡å™¨IP
```

---

### ç¬¬2æ­¥ï¼šå¼€æ”¾ç«¯å£ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# SSHç™»å½•æœåŠ¡å™¨åŽæ‰§è¡Œ
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload
```

**äº‘æœåŠ¡å™¨å®‰å…¨ç»„ä¹Ÿè¦å¼€æ”¾ï¼š**
- ç«¯å£ 80ï¼ˆHTTPï¼‰
- ç«¯å£ 443ï¼ˆHTTPSï¼‰

---

### ç¬¬3æ­¥ï¼šéƒ¨ç½²åº”ç”¨ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# ä¸Šä¼ ä»£ç ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰
cd /Users/xinguanliyuan/Desktop/indoor_chart
tar -czf chiavow.tar.gz chiavow/
scp chiavow.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/root/

# åœ¨æœåŠ¡å™¨ä¸Š
cd /root
tar -xzf chiavow.tar.gz
cd chiavow

# éƒ¨ç½²åŽç«¯
cd server
npm install --production
npm run build
cat > .env << 'EOF'
PORT=3001
JWT_SECRET=$(openssl rand -base64 32)
NODE_ENV=production
EOF
pm2 start dist/index.js --name chiavow-api
pm2 save
pm2 startup

# éƒ¨ç½²å‰ç«¯
cd ../client
npm install
npm run build
```

---

### ç¬¬4æ­¥ï¼šèŽ·å–SSLè¯ä¹¦ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# å®‰è£…Certbot
sudo apt update
sudo apt install -y certbot python3-certbot-nginx

# èŽ·å–è¯ä¹¦ï¼ˆæ›¿æ¢æˆä½ çš„åŸŸåï¼‰
sudo certbot certonly --standalone -d chiavow.com -d www.chiavow.com

# æŒ‰æç¤ºè¾“å…¥é‚®ç®±ï¼ŒåŒæ„æ¡æ¬¾
```

**è¯ä¹¦ä½ç½®ï¼š**
- è¯ä¹¦ï¼š`/etc/letsencrypt/live/chiavow.com/fullchain.pem`
- ç§é’¥ï¼š`/etc/letsencrypt/live/chiavow.com/privkey.pem`

---

### ç¬¬5æ­¥ï¼šé…ç½®Nginxï¼ˆ8åˆ†é’Ÿï¼‰

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/chiavow
```

**å¤åˆ¶ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼ˆæ›¿æ¢åŸŸåï¼‰ï¼š**

```nginx
# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name chiavow.com www.chiavow.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS
server {
    listen 443 ssl http2;
    server_name chiavow.com www.chiavow.com;

    # SSLè¯ä¹¦
    ssl_certificate /etc/letsencrypt/live/chiavow.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/chiavow.com/privkey.pem;

    # å‰ç«¯
    location / {
        root /root/chiavow/client/dist;
        try_files $uri $uri/ /index.html;
    }

    # åŽç«¯API
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ä¸Šä¼ æ–‡ä»¶
    location /uploads {
        proxy_pass http://localhost:3001;
    }

    client_max_body_size 10M;
}
```

**å¯ç”¨å¹¶å¯åŠ¨ï¼š**

```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/chiavow /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default  # åˆ é™¤é»˜è®¤é…ç½®

# æµ‹è¯•
sudo nginx -t

# å¦‚æžœæµ‹è¯•é€šè¿‡ï¼Œé‡å¯
sudo systemctl restart nginx
sudo systemctl enable nginx
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# åŽç«¯
pm2 status  # åº”è¯¥æ˜¾ç¤º online

# Nginx
sudo systemctl status nginx  # åº”è¯¥æ˜¾ç¤º active (running)
```

### 2. æµè§ˆå™¨æµ‹è¯•

1. è®¿é—® `http://chiavow.com` â†’ åº”è‡ªåŠ¨è·³è½¬åˆ° `https://chiavow.com`
2. åœ°å€æ åº”æ˜¾ç¤ºðŸ”’é”å›¾æ ‡
3. åº”ç”¨å¯ä»¥æ­£å¸¸ä½¿ç”¨

### 3. SSLæµ‹è¯•

è®¿é—®ï¼šhttps://www.ssllabs.com/ssltest/
è¾“å…¥ä½ çš„åŸŸåæµ‹è¯•ï¼Œåº”è¯¥å¾—åˆ° A æˆ– A+ è¯„çº§

---

## ðŸ”„ è‡ªåŠ¨ç»­æœŸ

Let's Encryptè¯ä¹¦90å¤©è¿‡æœŸï¼Œéœ€è¦è‡ªåŠ¨ç»­æœŸï¼š

```bash
# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# å¦‚æžœæµ‹è¯•æˆåŠŸï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»­æœŸï¼ˆå·²é…ç½®å¥½ï¼‰
# æŸ¥çœ‹ç»­æœŸå®šæ—¶ä»»åŠ¡
sudo systemctl status certbot.timer
```

---

## ðŸ› å¸¸è§é—®é¢˜é€ŸæŸ¥

### é—®é¢˜1ï¼šè®¿é—®åŸŸåæ˜¾ç¤º502

```bash
# æ£€æŸ¥åŽç«¯æ˜¯å¦è¿è¡Œ
pm2 status

# å¦‚æžœæ²¡è¿è¡Œï¼Œå¯åŠ¨
cd /root/chiavow/server
pm2 start dist/index.js --name chiavow-api

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 3001
```

### é—®é¢˜2ï¼šæ— æ³•èŽ·å–SSLè¯ä¹¦

```bash
# ç¡®ä¿80å’Œ443ç«¯å£å¼€æ”¾
sudo ufw status

# åœæ­¢Nginxå†è¯•
sudo systemctl stop nginx
sudo certbot certonly --standalone -d chiavow.com -d www.chiavow.com
sudo systemctl start nginx
```

### é—®é¢˜3ï¼šHTTPSæ˜¾ç¤ºä¸å®‰å…¨

```bash
# æ£€æŸ¥è¯ä¹¦è·¯å¾„æ˜¯å¦æ­£ç¡®
sudo certbot certificates

# æ£€æŸ¥nginxé…ç½®
sudo nginx -t

# é‡å¯nginx
sudo systemctl restart nginx
```

### é—®é¢˜4ï¼šAPIè¯·æ±‚å¤±è´¥ï¼ˆCORSé”™è¯¯ï¼‰

åŽç«¯éœ€è¦é…ç½®CORSï¼Œæ£€æŸ¥ `server/src/index.ts`ï¼š

```typescript
import cors from 'cors'
app.use(cors())
```

---

## ðŸ“Š æˆæœ¬ä¼°ç®—

| é¡¹ç›® | æŽ¨èæ–¹æ¡ˆ | ä»·æ ¼ |
|------|---------|------|
| åŸŸå | Namecheap .com | Â¥55/å¹´ |
| æœåŠ¡å™¨ | é˜¿é‡Œäº‘ECSï¼ˆ2æ ¸4Gï¼‰ | Â¥100/æœˆ |
| SSLè¯ä¹¦ | Let's Encrypt | å…è´¹ |
| CDNï¼ˆå¯é€‰ï¼‰ | Cloudflare | å…è´¹ |
| **æ€»è®¡** | | **çº¦Â¥150/æœˆ** |

---

## ðŸŽ¯ ä¼˜åŒ–å»ºè®®

### ç«‹å³ä¼˜åŒ–
- [x] å·²é…ç½® HTTPS
- [x] å·²é…ç½® HTTP/2
- [x] å·²é…ç½® GzipåŽ‹ç¼©

### å¯é€‰ä¼˜åŒ–
- [ ] ä½¿ç”¨ Cloudflare CDNï¼ˆå…è´¹åŠ é€Ÿï¼‰
- [ ] é…ç½® Redis ç¼“å­˜
- [ ] ä½¿ç”¨ PM2 cluster æ¨¡å¼
- [ ] é…ç½® Nginx ç¼“å­˜

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

### æ£€æŸ¥æ—¥å¿—

```bash
# Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# Nginxè®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# PM2æ—¥å¿—
pm2 logs chiavow-api

# Certbotæ—¥å¿—
sudo journalctl -u certbot
```

### é‡å¯æ‰€æœ‰æœåŠ¡

```bash
# é‡å¯åŽç«¯
pm2 restart chiavow-api

# é‡å¯Nginx
sudo systemctl restart nginx

# å¦‚æžœéƒ½ä¸è¡Œï¼Œé‡å¯æœåŠ¡å™¨
sudo reboot
```

---

## ðŸŽ‰ å®Œæˆï¼

å¦‚æžœæ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸï¼š

âœ… ä½ çš„ç½‘ç«™å¯ä»¥é€šè¿‡ `https://chiavow.com` è®¿é—®
âœ… HTTPä¼šè‡ªåŠ¨è·³è½¬åˆ°HTTPS
âœ… SSLè¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ
âœ… åº”ç”¨å·²ç»åœ¨ç”Ÿäº§çŽ¯å¢ƒè¿è¡Œ

**ä¸‹ä¸€æ­¥ï¼š**
- é…ç½®æ•°æ®åº“ï¼ˆMongoDB/PostgreSQLï¼‰
- é…ç½®é‚®ä»¶æœåŠ¡
- é…ç½®ç›‘æŽ§å’Œå‘Šè­¦
- å®šæœŸå¤‡ä»½æ•°æ®

---

**è¯¦ç»†æ–‡æ¡£ï¼š** [åŸŸåå’ŒHTTPSé…ç½®æŒ‡å—.md](./åŸŸåå’ŒHTTPSé…ç½®æŒ‡å—.md)
