# ðŸŒ åŸŸåé…ç½®å’ŒHTTPSéƒ¨ç½²å®Œæ•´æŒ‡å—

## ðŸ“‹ ç›®å½•
1. [è´­ä¹°åŸŸå](#1-è´­ä¹°åŸŸå)
2. [é…ç½®åŸŸåè§£æž](#2-é…ç½®åŸŸåè§£æž)
3. [äº‘æœåŠ¡å™¨é…ç½®](#3-äº‘æœåŠ¡å™¨é…ç½®)
4. [éƒ¨ç½²åº”ç”¨](#4-éƒ¨ç½²åº”ç”¨)
5. [é…ç½®HTTPSè¯ä¹¦](#5-é…ç½®httpsè¯ä¹¦)
6. [è‡ªåŠ¨ç»­æœŸè®¾ç½®](#6-è‡ªåŠ¨ç»­æœŸè®¾ç½®)
7. [å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)

---

## 1. è´­ä¹°åŸŸå

### æŽ¨èåŸŸåæ³¨å†Œå•†

#### å›½å†…ï¼ˆéœ€è¦å¤‡æ¡ˆï¼‰
- **é˜¿é‡Œäº‘** (https://wanwang.aliyun.com)
  - ä»·æ ¼ï¼š.com çº¦ Â¥55-78/å¹´
  - ä¼˜åŠ¿ï¼šä¸Žé˜¿é‡Œäº‘ECSé›†æˆå¥½ï¼Œå¤‡æ¡ˆæ–¹ä¾¿

- **è…¾è®¯äº‘** (https://dnspod.cloud.tencent.com)
  - ä»·æ ¼ï¼š.com çº¦ Â¥55-88/å¹´
  - ä¼˜åŠ¿ï¼šé€å…è´¹SSLè¯ä¹¦

- **åŽä¸ºäº‘** (https://www.huaweicloud.com)
  - ä»·æ ¼ï¼š.com çº¦ Â¥60-85/å¹´

#### å›½å¤–ï¼ˆæ— éœ€å¤‡æ¡ˆï¼‰
- **Namecheap** (https://www.namecheap.com)
  - ä»·æ ¼ï¼š.com çº¦ $8-12/å¹´
  - ä¼˜åŠ¿ï¼šä¾¿å®œï¼Œéšç§ä¿æŠ¤å…è´¹

- **GoDaddy** (https://www.godaddy.com)
  - ä»·æ ¼ï¼š.com çº¦ $10-15/å¹´
  - ä¼˜åŠ¿ï¼šçŸ¥ååº¦é«˜

- **Cloudflare** (https://www.cloudflare.com)
  - ä»·æ ¼ï¼š.com çº¦ $8.57/å¹´ï¼ˆæˆæœ¬ä»·ï¼‰
  - ä¼˜åŠ¿ï¼šé€å…è´¹CDNå’ŒSSL

### æŽ¨èåŸŸååŽç¼€

| åŽç¼€ | ä»·æ ¼/å¹´ | é€‚åˆåœºæ™¯ | å¤‡æ³¨ |
|------|---------|----------|------|
| .com | Â¥55-88 | å•†ä¸šç½‘ç«™ | æœ€å¸¸è§ï¼ŒæŽ¨è |
| .cn | Â¥29-45 | ä¸­å›½ç½‘ç«™ | éœ€è¦å¤‡æ¡ˆ |
| .net | Â¥55-88 | æŠ€æœ¯ç½‘ç«™ | ä¸é”™çš„é€‰æ‹© |
| .xyz | Â¥8-15 | ä¸ªäººé¡¹ç›® | ä¾¿å®œä½†ä¸å¤Ÿæ­£å¼ |
| .top | Â¥5-10 | æµ‹è¯•é¡¹ç›® | å¾ˆä¾¿å®œ |

### è´­ä¹°æµç¨‹ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰

1. **æœç´¢åŸŸå**
   - è®¿é—® https://wanwang.aliyun.com
   - è¾“å…¥æƒ³è¦çš„åŸŸåï¼Œå¦‚ `chiavow.com`
   - æ£€æŸ¥å¯ç”¨æ€§

2. **åŠ å…¥è´­ç‰©è½¦**
   - é€‰æ‹©è´­ä¹°å¹´é™ï¼ˆå»ºè®®1-3å¹´ï¼‰
   - å‹¾é€‰"åŸŸåéšç§ä¿æŠ¤"ï¼ˆå…è´¹ï¼‰

3. **å®Œæˆæ”¯ä»˜**
   - å¡«å†™åŸŸåæ‰€æœ‰è€…ä¿¡æ¯
   - å®Œæˆå®žåè®¤è¯ï¼ˆå›½å†…å¿…é¡»ï¼‰
   - æ”¯ä»˜è´¹ç”¨

4. **ç­‰å¾…å®¡æ ¸**
   - å®žåè®¤è¯é€šå¸¸1-3å¤©
   - å®¡æ ¸é€šè¿‡åŽæ‰èƒ½ä½¿ç”¨

---

## 2. é…ç½®åŸŸåè§£æž

### 2.1 èŽ·å–æœåŠ¡å™¨IPåœ°å€

SSHç™»å½•ä½ çš„äº‘æœåŠ¡å™¨ï¼š
```bash
# æŸ¥çœ‹å…¬ç½‘IP
curl ifconfig.me
# æˆ–
curl icanhazip.com
```

è®°å½•ä¸‹è¿™ä¸ªIPåœ°å€ï¼Œå¦‚ï¼š`47.100.123.456`

### 2.2 æ·»åŠ DNSè§£æžè®°å½•

#### é˜¿é‡Œäº‘åŸŸåè§£æž

1. **è¿›å…¥åŸŸåæŽ§åˆ¶å°**
   - ç™»å½•é˜¿é‡Œäº‘
   - äº§å“ä¸ŽæœåŠ¡ â†’ åŸŸå â†’ åŸŸååˆ—è¡¨
   - æ‰¾åˆ°ä½ çš„åŸŸåï¼Œç‚¹å‡»"è§£æž"

2. **æ·»åŠ Aè®°å½•ï¼ˆä¸»åŸŸåï¼‰**
   ```
   è®°å½•ç±»åž‹ï¼šA
   ä¸»æœºè®°å½•ï¼š@
   è§£æžçº¿è·¯ï¼šé»˜è®¤
   è®°å½•å€¼ï¼š47.100.123.456ï¼ˆä½ çš„æœåŠ¡å™¨IPï¼‰
   TTLï¼š10åˆ†é’Ÿ
   ```

3. **æ·»åŠ Aè®°å½•ï¼ˆwwwå­åŸŸåï¼‰**
   ```
   è®°å½•ç±»åž‹ï¼šA
   ä¸»æœºè®°å½•ï¼šwww
   è§£æžçº¿è·¯ï¼šé»˜è®¤
   è®°å½•å€¼ï¼š47.100.123.456ï¼ˆä½ çš„æœåŠ¡å™¨IPï¼‰
   TTLï¼š10åˆ†é’Ÿ
   ```

4. **éªŒè¯è§£æž**
   ```bash
   # ç­‰å¾…5-10åˆ†é’ŸåŽæµ‹è¯•
   ping chiavow.com
   ping www.chiavow.com

   # æˆ–ä½¿ç”¨nslookup
   nslookup chiavow.com
   ```

#### CloudflareåŸŸåè§£æžï¼ˆæŽ¨èï¼Œå…è´¹CDN+SSLï¼‰

1. **æ·»åŠ ç½‘ç«™åˆ°Cloudflare**
   - ç™»å½• https://dash.cloudflare.com
   - ç‚¹å‡»"Add a Site"
   - è¾“å…¥åŸŸåï¼š`chiavow.com`
   - é€‰æ‹©Freeè®¡åˆ’

2. **ä¿®æ”¹åŸŸåæœåŠ¡å™¨**
   - Cloudflareä¼šç»™ä½ ä¸¤ä¸ªnameservers
   - åŽ»åŸŸåæ³¨å†Œå•†ä¿®æ”¹DNSæœåŠ¡å™¨
   - ç­‰å¾…DNSç”Ÿæ•ˆï¼ˆæœ€å¤š24å°æ—¶ï¼‰

3. **æ·»åŠ DNSè®°å½•**
   ```
   ç±»åž‹ï¼šA
   åç§°ï¼š@
   IPv4åœ°å€ï¼š47.100.123.456
   ä»£ç†çŠ¶æ€ï¼šå·²ä»£ç†ï¼ˆæ©™è‰²äº‘æœµï¼‰

   ç±»åž‹ï¼šA
   åç§°ï¼šwww
   IPv4åœ°å€ï¼š47.100.123.456
   ä»£ç†çŠ¶æ€ï¼šå·²ä»£ç†ï¼ˆæ©™è‰²äº‘æœµï¼‰
   ```

4. **å¼€å¯è‡ªåŠ¨HTTPSé‡å†™**
   - SSL/TLS â†’ Edge Certificates
   - å¼€å¯"Always Use HTTPS"
   - å¼€å¯"Automatic HTTPS Rewrites"

---

## 3. äº‘æœåŠ¡å™¨é…ç½®

### 3.1 å®‰å…¨ç»„é…ç½®

#### é˜¿é‡Œäº‘ECS

1. **è¿›å…¥å®žä¾‹ç®¡ç†**
   - æŽ§åˆ¶å° â†’ äº‘æœåŠ¡å™¨ECS â†’ å®žä¾‹
   - ç‚¹å‡»ä½ çš„å®žä¾‹ID

2. **é…ç½®å®‰å…¨ç»„è§„åˆ™**
   - å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™ â†’ æ·»åŠ è§„åˆ™

   **å¿…é¡»å¼€æ”¾çš„ç«¯å£ï¼š**
   ```
   å…¥æ–¹å‘è§„åˆ™ï¼š
   - HTTPï¼š80/80ï¼Œæºï¼š0.0.0.0/0
   - HTTPSï¼š443/443ï¼Œæºï¼š0.0.0.0/0
   - SSHï¼š22/22ï¼Œæºï¼šä½ çš„IPï¼ˆæŽ¨èï¼‰æˆ– 0.0.0.0/0

   å‡ºæ–¹å‘è§„åˆ™ï¼š
   - å…¨éƒ¨å…è®¸
   ```

#### è…¾è®¯äº‘CVM

1. **å®‰å…¨ç»„é…ç½®**
   - æŽ§åˆ¶å° â†’ äº‘æœåŠ¡å™¨ â†’ å®‰å…¨ç»„
   - æ–°å»ºå®‰å…¨ç»„æˆ–ç¼–è¾‘çŽ°æœ‰

2. **æ·»åŠ è§„åˆ™**
   ```
   å…¥ç«™è§„åˆ™ï¼š
   - HTTPï¼šTCP:80ï¼Œæºï¼š0.0.0.0/0
   - HTTPSï¼šTCP:443ï¼Œæºï¼š0.0.0.0/0
   - SSHï¼šTCP:22ï¼Œæºï¼šä½ çš„IP
   ```

### 3.2 é˜²ç«å¢™é…ç½®

SSHç™»å½•æœåŠ¡å™¨åŽï¼š

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¦‚æžœæœªå¯ç”¨ï¼Œå…ˆå¯ç”¨
sudo ufw enable

# å…è®¸å¿…è¦ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp

# é‡æ–°åŠ è½½
sudo ufw reload

# éªŒè¯
sudo ufw status numbered
```

---

## 4. éƒ¨ç½²åº”ç”¨

### 4.1 ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

**æ–¹æ³•1ï¼šGitï¼ˆæŽ¨èï¼‰**
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /root
git clone https://github.com/ä½ çš„ç”¨æˆ·å/chiavow.git
cd chiavow
```

**æ–¹æ³•2ï¼šSCPä¸Šä¼ **
```bash
# åœ¨æœ¬åœ°æœºå™¨
cd /Users/xinguanliyuan/Desktop/indoor_chart
tar -czf chiavow.tar.gz chiavow/
scp chiavow.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/root/

# åœ¨æœåŠ¡å™¨ä¸Š
cd /root
tar -xzf chiavow.tar.gz
```

### 4.2 å®‰è£…ä¾èµ–å¹¶å¯åŠ¨

```bash
cd /root/chiavow

# å®‰è£…åŽç«¯ä¾èµ–
cd server
npm install --production
npm run build

# é…ç½®çŽ¯å¢ƒå˜é‡
cat > .env << 'EOF'
PORT=3001
JWT_SECRET=$(openssl rand -base64 32)
NODE_ENV=production
EOF

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start dist/index.js --name chiavow-api
pm2 save
pm2 startup

# å®‰è£…å‰ç«¯ä¾èµ–å¹¶æž„å»º
cd ../client
npm install
npm run build
```

---

## 5. é…ç½®HTTPSè¯ä¹¦

### æ–¹æ³•1ï¼šLet's Encryptï¼ˆå…è´¹ï¼ŒæŽ¨èï¼‰

#### 5.1 å®‰è£…Certbot

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install -y certbot python3-certbot-nginx
```

#### 5.2 èŽ·å–è¯ä¹¦

```bash
# åœæ­¢nginxï¼ˆå¦‚æžœæ­£åœ¨è¿è¡Œï¼‰
sudo systemctl stop nginx

# èŽ·å–è¯ä¹¦ï¼ˆæ–¹å¼1ï¼šç‹¬ç«‹æ¨¡å¼ï¼‰
sudo certbot certonly --standalone -d chiavow.com -d www.chiavow.com

# æˆ–è€…ï¼ˆæ–¹å¼2ï¼šnginxæ¨¡å¼ï¼Œnginxå·²é…ç½®çš„æƒ…å†µï¼‰
sudo certbot --nginx -d chiavow.com -d www.chiavow.com

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾
# 3. é€‰æ‹©æ˜¯å¦æŽ¥æ”¶é‚®ä»¶
```

#### 5.3 é…ç½®Nginxä½¿ç”¨è¯ä¹¦

åˆ›å»ºæˆ–ç¼–è¾‘Nginxé…ç½®ï¼š

```bash
sudo nano /etc/nginx/sites-available/chiavow
```

å®Œæ•´é…ç½®ï¼š

```nginx
# HTTP - é‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name chiavow.com www.chiavow.com;

    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

# HTTPS
server {
    listen 443 ssl http2;
    server_name chiavow.com www.chiavow.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/chiavow.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/chiavow.com/privkey.pem;

    # SSLä¼˜åŒ–é…ç½®
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    # çŽ°ä»£æµè§ˆå™¨SSLé…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
    ssl_prefer_server_ciphers off;

    # HSTSï¼ˆå¼ºåˆ¶HTTPSï¼‰
    add_header Strict-Transport-Security "max-age=63072000" always;

    # å…¶ä»–å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /root/chiavow/client/dist;
        try_files $uri $uri/ /index.html;
    }

    # åŽç«¯API
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads {
        proxy_pass http://localhost:3001;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # GzipåŽ‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss;

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 10M;
}
```

#### 5.4 å¯ç”¨é…ç½®å¹¶æµ‹è¯•

```bash
# åˆ›å»ºè½¯é“¾æŽ¥
sudo ln -s /etc/nginx/sites-available/chiavow /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# å¦‚æžœæµ‹è¯•é€šè¿‡ï¼Œé‡å¯nginx
sudo systemctl restart nginx
sudo systemctl enable nginx

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status nginx
```

### æ–¹æ³•2ï¼šä½¿ç”¨Cloudflareï¼ˆæ›´ç®€å•ï¼ŒæŽ¨èæ–°æ‰‹ï¼‰

å¦‚æžœä½¿ç”¨Cloudflare DNSï¼š

1. **è‡ªåŠ¨HTTPS**
   - SSL/TLS â†’ Overview
   - é€‰æ‹©"Full (strict)"æ¨¡å¼

2. **ç”ŸæˆOriginè¯ä¹¦ï¼ˆå¯é€‰ï¼‰**
   - SSL/TLS â†’ Origin Server
   - Create Certificate
   - ä¸‹è½½è¯ä¹¦å’Œç§é’¥
   - ä¸Šä¼ åˆ°æœåŠ¡å™¨

3. **ç®€åŒ–çš„Nginxé…ç½®**
   ```nginx
   server {
       listen 80;
       server_name chiavow.com www.chiavow.com;

       # Cloudflareå·²å¤„ç†HTTPSï¼Œæ— éœ€é‡å®šå‘

       location / {
           root /root/chiavow/client/dist;
           try_files $uri $uri/ /index.html;
       }

       location /api {
           proxy_pass http://localhost:3001;
           # ... å…¶ä»–é…ç½®
       }
   }
   ```

---

## 6. è‡ªåŠ¨ç»­æœŸè®¾ç½®

### Let's Encryptè¯ä¹¦è‡ªåŠ¨ç»­æœŸ

Let's Encryptè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ï¼Œéœ€è¦å®šæœŸç»­æœŸã€‚

#### 6.1 æµ‹è¯•ç»­æœŸ

```bash
# æµ‹è¯•ç»­æœŸï¼ˆä¸å®žé™…ç»­æœŸï¼‰
sudo certbot renew --dry-run

# å¦‚æžœæµ‹è¯•æˆåŠŸï¼Œä¼šæ˜¾ç¤ºï¼š
# Congratulations, all simulated renewals succeeded
```

#### 6.2 é…ç½®è‡ªåŠ¨ç»­æœŸ

```bash
# Certbotä¼šè‡ªåŠ¨åˆ›å»ºç»­æœŸä»»åŠ¡
# æ£€æŸ¥cronæˆ–systemd timer
sudo systemctl status certbot.timer

# æˆ–æŸ¥çœ‹cronä»»åŠ¡
sudo crontab -l
```

#### 6.3 æ‰‹åŠ¨æ·»åŠ ç»­æœŸä»»åŠ¡ï¼ˆå¦‚æžœéœ€è¦ï¼‰

```bash
# ç¼–è¾‘crontab
sudo crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ£€æŸ¥ç»­æœŸï¼‰
0 2 * * * certbot renew --quiet --post-hook "systemctl reload nginx"
```

#### 6.4 éªŒè¯è‡ªåŠ¨ç»­æœŸ

```bash
# æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´
sudo certbot certificates

# è¾“å‡ºç¤ºä¾‹ï¼š
# Certificate Name: chiavow.com
#   Domains: chiavow.com www.chiavow.com
#   Expiry Date: 2025-02-13 12:00:00+00:00 (VALID: 89 days)
```

---

## 7. å¸¸è§é—®é¢˜

### 7.1 åŸŸåç›¸å…³

**Q: åŸŸåéœ€è¦å¤‡æ¡ˆå—ï¼Ÿ**
A:
- ä½¿ç”¨å›½å†…æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ï¼šå¿…é¡»å¤‡æ¡ˆ
- ä½¿ç”¨å›½å¤–æœåŠ¡å™¨ï¼ˆAWSã€DigitalOceanç­‰ï¼‰ï¼šä¸éœ€è¦å¤‡æ¡ˆ

**Q: å¤‡æ¡ˆéœ€è¦å¤šä¹…ï¼Ÿ**
A: é€šå¸¸15-20ä¸ªå·¥ä½œæ—¥

**Q: åŸŸåè§£æžéœ€è¦å¤šä¹…ç”Ÿæ•ˆï¼Ÿ**
A:
- å›½å†…DNSï¼š5åˆ†é’Ÿ-2å°æ—¶
- å›½é™…DNSï¼šæœ€å¤š24-48å°æ—¶

**Q: å¦‚ä½•éªŒè¯åŸŸåè§£æžæˆåŠŸï¼Ÿ**
```bash
# æ–¹æ³•1
ping chiavow.com

# æ–¹æ³•2
nslookup chiavow.com

# æ–¹æ³•3
dig chiavow.com

# æ–¹æ³•4ï¼ˆåœ¨çº¿å·¥å…·ï¼‰
# https://www.whatsmydns.net
```

### 7.2 SSLè¯ä¹¦ç›¸å…³

**Q: Let's Encryptè¯ä¹¦æ˜¯å¦å®‰å…¨ï¼Ÿ**
A: æ˜¯çš„ï¼Œå’Œä»˜è´¹è¯ä¹¦ä¸€æ ·å®‰å…¨ï¼Œåªæ˜¯æœ‰æ•ˆæœŸè¾ƒçŸ­ï¼ˆ90å¤©ï¼‰

**Q: è¯ä¹¦ç»­æœŸå¤±è´¥æ€Žä¹ˆåŠžï¼Ÿ**
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo certbot renew --force-renewal

# å¦‚æžœå¤±è´¥ï¼Œæ‰‹åŠ¨é‡æ–°èŽ·å–
sudo certbot certonly --standalone -d chiavow.com -d www.chiavow.com --force-renewal
```

**Q: æµè§ˆå™¨æ˜¾ç¤º"ä¸å®‰å…¨"æ€Žä¹ˆåŠžï¼Ÿ**
- æ£€æŸ¥è¯ä¹¦æ˜¯å¦æ­£ç¡®å®‰è£…
- æ£€æŸ¥nginxé…ç½®æ˜¯å¦æ­£ç¡®
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ

**Q: æ··åˆå†…å®¹è­¦å‘Šï¼ˆMixed Contentï¼‰ï¼Ÿ**
- ç¡®ä¿æ‰€æœ‰èµ„æºéƒ½ä½¿ç”¨HTTPS
- æ£€æŸ¥APIè°ƒç”¨æ˜¯å¦ä½¿ç”¨HTTPS
- æ·»åŠ CSPå¤´ï¼š
  ```nginx
  add_header Content-Security-Policy "upgrade-insecure-requests";
  ```

### 7.3 Nginxç›¸å…³

**Q: nginxé…ç½®æµ‹è¯•å¤±è´¥ï¼Ÿ**
```bash
# æŸ¥çœ‹å…·ä½“é”™è¯¯
sudo nginx -t

# å¸¸è§é”™è¯¯ï¼š
# 1. è¯­æ³•é”™è¯¯ï¼šæ£€æŸ¥åˆ†å·ã€æ‹¬å·
# 2. è¯ä¹¦è·¯å¾„é”™è¯¯ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
# 3. ç«¯å£å†²çªï¼šæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœåŠ¡å ç”¨80/443ç«¯å£
```

**Q: å¦‚ä½•æŸ¥çœ‹nginxé”™è¯¯æ—¥å¿—ï¼Ÿ**
```bash
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log
```

**Q: 502 Bad Gatewayé”™è¯¯ï¼Ÿ**
- æ£€æŸ¥åŽç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`pm2 status`
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼š`netstat -tlnp | grep 3001`
- æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`

### 7.4 æ€§èƒ½ä¼˜åŒ–

**Q: å¦‚ä½•æé«˜ç½‘ç«™é€Ÿåº¦ï¼Ÿ**

1. **å¯ç”¨GzipåŽ‹ç¼©**ï¼ˆå·²åœ¨é…ç½®ä¸­ï¼‰
2. **å¯ç”¨æµè§ˆå™¨ç¼“å­˜**ï¼ˆå·²åœ¨é…ç½®ä¸­ï¼‰
3. **ä½¿ç”¨CDN**
   - Cloudflareï¼ˆå…è´¹ï¼‰
   - é˜¿é‡Œäº‘CDN
   - è…¾è®¯äº‘CDN

4. **ä¼˜åŒ–å›¾ç‰‡**
   ```bash
   # å®‰è£…ä¼˜åŒ–å·¥å…·
   sudo apt install imagemagick

   # åŽ‹ç¼©å›¾ç‰‡
   mogrify -resize 800x800 -quality 85 *.jpg
   ```

5. **å¯ç”¨HTTP/2**ï¼ˆå·²åœ¨é…ç½®ä¸­ï¼‰

---

## 8. å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰
- [ ] åŸŸåå·²è´­ä¹°å¹¶å®žåè®¤è¯
- [ ] DNSè§£æžå·²é…ç½®ï¼ˆAè®°å½•ï¼‰
- [ ] äº‘æœåŠ¡å™¨å·²è´­ä¹°å¹¶å¯åŠ¨
- [ ] å®‰å…¨ç»„å·²é…ç½®ï¼ˆ80, 443, 22ç«¯å£ï¼‰
- [ ] SSHå¯ä»¥è¿žæŽ¥æœåŠ¡å™¨

### éƒ¨ç½²ä¸­
- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] Node.jså’Œnpmå·²å®‰è£…
- [ ] åŽç«¯ä¾èµ–å·²å®‰è£…å¹¶æž„å»º
- [ ] å‰ç«¯ä¾èµ–å·²å®‰è£…å¹¶æž„å»º
- [ ] PM2å·²å¯åŠ¨åŽç«¯æœåŠ¡
- [ ] Nginxå·²å®‰è£…
- [ ] SSLè¯ä¹¦å·²èŽ·å–
- [ ] Nginxé…ç½®å·²åˆ›å»º

### éƒ¨ç½²åŽ
- [ ] HTTPè®¿é—®æ­£å¸¸ï¼ˆhttp://chiavow.comï¼‰
- [ ] HTTPSè®¿é—®æ­£å¸¸ï¼ˆhttps://chiavow.comï¼‰
- [ ] HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- [ ] APIæŽ¥å£æ­£å¸¸å·¥ä½œ
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] è‡ªåŠ¨ç»­æœŸå·²é…ç½®
- [ ] PM2å¼€æœºè‡ªå¯å·²é…ç½®
- [ ] Nginxå¼€æœºè‡ªå¯å·²é…ç½®

### æµ‹è¯•
- [ ] SSL Labsæµ‹è¯•é€šè¿‡ï¼ˆhttps://www.ssllabs.com/ssltest/ï¼‰
- [ ] ç§»åŠ¨ç«¯è®¿é—®æ­£å¸¸
- [ ] PCç«¯è®¿é—®æ­£å¸¸
- [ ] ä¸åŒæµè§ˆå™¨è®¿é—®æ­£å¸¸
- [ ] HTTPSè¯ä¹¦æœ‰æ•ˆ

---

## 9. å¿«é€Ÿå‚è€ƒå‘½ä»¤

### åŸŸåéªŒè¯
```bash
# æ£€æŸ¥åŸŸåè§£æž
nslookup chiavow.com

# æµ‹è¯•HTTPè®¿é—®
curl http://chiavow.com

# æµ‹è¯•HTTPSè®¿é—®
curl https://chiavow.com
```

### SSLè¯ä¹¦
```bash
# èŽ·å–è¯ä¹¦
sudo certbot --nginx -d chiavow.com -d www.chiavow.com

# ç»­æœŸè¯ä¹¦
sudo certbot renew

# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
sudo certbot certificates

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

### Nginx
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯
sudo systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### PM2
```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs chiavow-api

# é‡å¯
pm2 restart chiavow-api

# ç›‘æŽ§
pm2 monit
```

---

## 10. æŽ¨èçš„å®Œæ•´æµç¨‹

### æ–°æ‰‹æŽ¨èï¼šCloudflare + Let's Encrypt

1. **è´­ä¹°åŸŸå**ï¼ˆä»»æ„æ³¨å†Œå•†ï¼ŒÂ¥55/å¹´ï¼‰
2. **è¿ç§»DNSåˆ°Cloudflare**ï¼ˆå…è´¹ï¼Œé€CDN+SSLï¼‰
3. **é…ç½®åŸŸåè§£æž**ï¼ˆAè®°å½•æŒ‡å‘æœåŠ¡å™¨ï¼‰
4. **éƒ¨ç½²åº”ç”¨**ï¼ˆæŒ‰ç…§æœ¬æ–‡æ¡£æ­¥éª¤ï¼‰
5. **èŽ·å–Let's Encryptè¯ä¹¦**ï¼ˆå…è´¹ï¼Œè‡ªåŠ¨ç»­æœŸï¼‰
6. **Cloudflareå¼€å¯HTTPS**ï¼ˆè‡ªåŠ¨ï¼Œæ— éœ€é…ç½®ï¼‰

### é«˜çº§ç”¨æˆ·ï¼šé˜¿é‡Œäº‘å…¨å®¶æ¡¶

1. **è´­ä¹°åŸŸå**ï¼ˆé˜¿é‡Œäº‘ï¼ŒÂ¥55/å¹´ï¼‰
2. **è´­ä¹°ECSæœåŠ¡å™¨**ï¼ˆé˜¿é‡Œäº‘ï¼ŒÂ¥100/æœˆèµ·ï¼‰
3. **å¤‡æ¡ˆ**ï¼ˆ15-20å¤©ï¼‰
4. **é…ç½®DNSè§£æž**ï¼ˆé˜¿é‡Œäº‘DNSï¼‰
5. **éƒ¨ç½²åº”ç”¨**
6. **èŽ·å–SSLè¯ä¹¦**ï¼ˆLet's Encryptæˆ–é˜¿é‡Œäº‘è¯ä¹¦ï¼‰
7. **å¯é€‰ï¼šå¼€å¯CDN**ï¼ˆé˜¿é‡Œäº‘CDNï¼ŒåŠ é€Ÿè®¿é—®ï¼‰

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- Let's Encryptæ–‡æ¡£ï¼šhttps://letsencrypt.org/zh-cn/docs/
- Nginxæ–‡æ¡£ï¼šhttp://nginx.org/en/docs/
- Certbotæ–‡æ¡£ï¼šhttps://certbot.eff.org/

**ç¥éƒ¨ç½²æˆåŠŸï¼** ðŸŽ‰
